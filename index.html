<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Eredivisie Fantasy Stats</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>
    <style>
      body {
        font-family: Arial, sans-serif;
        padding: 2rem;
        background: #fafafa;
        color: #222;
      }
      input, select, button {
        margin: 0.5rem;
        padding: 0.5rem;
        font-size: 1rem;
      }
      button {
        cursor: pointer;
      }
      table {
        border-collapse: collapse;
        width: 100%;
        margin-top: 1rem;
        background: white;
        box-shadow: 0 1px 3px rgba(0,0,0,0.1);
      }
      th, td {
        border: 1px solid #ddd;
        padding: 0.6rem;
        text-align: left;
      }
      th {
        background-color: #f0f0f0;
      }
      h1, h2 {
        margin-top: 2rem;
      }
      .controls {
        display: flex;
        flex-wrap: wrap;
        gap: 0.5rem;
        margin-bottom: 1rem;
      }
    </style>
  </head>
  <body>
    <div id="root"></div>

    <script type="text/babel">
      const { useState } = React;

      function App() {
        const [fplId, setFplId] = useState("");
        const [amount, setAmount] = useState("10000");
        const [players, setPlayers] = useState([]);
        const [captains, setCaptains] = useState([]);
        const [loading, setLoading] = useState(false);
        const [error, setError] = useState("");

        const fetchData = async (id, topCount) => {
          if (!id) {
            setError("Please enter an FPL ID");
            return;
          }
          setError("");
          setLoading(true);

          try {
            // Players
            const playerRes = await fetch(
              `https://efvdata-production.up.railway.app/api/players?fplId=${id}&topManagersCount=${topCount}`
            );
            const playerData = await playerRes.json();
            setPlayers(playerData.players || []);

            // Captains
            const captainRes = await fetch(
              `https://efvdata-production.up.railway.app/api/captains?topManagersCount=${topCount}`
            );
            const captainData = await captainRes.json();
            setCaptains(captainData.captains || []);
          } catch (err) {
            console.error("Error loading data:", err);
            setError("Failed to load data");
          } finally {
            setLoading(false);
          }
        };

        return (
          <div>
            <h1>Eredivisie Fantasy Stats</h1>

            <div className="controls">
              <input
                type="text"
                placeholder="Enter FPL ID"
                value={fplId}
                onChange={(e) => setFplId(e.target.value)}
              />
              <button onClick={() => fetchData(fplId, amount)}>Apply FPL ID</button>

              <select
                value={amount}
                onChange={(e) => setAmount(e.target.value)}
              >
                <option value="10000">Top 10,000</option>
                <option value="5000">Top 5,000</option>
                <option value="1000">Top 1,000</option>
                <option value="500">Top 500</option>
                <option value="100">Top 100</option>
              </select>
              <button onClick={() => fetchData(fplId, amount)}>Apply Rank</button>
            </div>

            {loading && <p>Loading...</p>}
            {error && <p style={{ color: "red" }}>{error}</p>}

            {players.length > 0 && (
              <React.Fragment>
                <h2>Most Selected Players</h2>
                <table>
                  <thead>
                    <tr>
                      <th>#</th>
                      <th>Player</th>
                      <th>Team</th>
                      <th>% Owned</th>
                    </tr>
                  </thead>
                  <tbody>
                    {players.map((p, i) => (
                      <tr key={i}>
                        <td>{i + 1}</td>
                        <td>{p.name}</td>
                        <td>{p.team}</td>
                        <td>{p.ownership.toFixed(2)}%</td>
                      </tr>
                    ))}
                  </tbody>
                </table>
              </React.Fragment>
            )}

            {captains.length > 0 && (
              <React.Fragment>
                <h2>Top 10 Captains â€“ Speelronde 9</h2>
                <table>
                  <thead>
                    <tr>
                      <th>#</th>
                      <th>Player</th>
                      <th>% Captained</th>
                    </tr>
                  </thead>
                  <tbody>
                    {captains.map((c, i) => (
                      <tr key={i}>
                        <td>{i + 1}</td>
                        <td>{c.name}</td>
                        <td>{c.captain_percent.toFixed(2)}%</td>
                      </tr>
                    ))}
                  </tbody>
                </table>
              </React.Fragment>
            )}
          </div>
        );
      }

      ReactDOM.render(<App />, document.getElementById("root"));
    </script>
  </body>
</html>
